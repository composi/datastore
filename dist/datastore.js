(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.datastore={})})(this,function(a){"use strict";function b(a){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b(a)}function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a){return"number"==typeof a&&isNaN(a)?"NaN":/\[object (.*)]/.exec(toString.call(a))[1]}function g(...a){const b=a.map(a=>JSON.parse(JSON.stringify(a)));return b.reduce((c,a)=>Object.assign({},c,a))}class h{constructor(){this.events={}}watch(a,b){return this.events[a]=[],this.events[a].push(b)}dispatch(a,b){return this.events.hasOwnProperty(a)?this.events[a].map(a=>a(b)):[]}unwatch(a){this.events[a]}}var i={},j=function(){let a=new Date().getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(a+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){let c=0|(a+16*Math.random())%16;return a=Math.floor(a/16),("x"===b?c:8|3&c).toString(16)})}(),k=function(){function a(b){c(this,a),this[j]=void 0,this.observer=new h,this.state=b.state,this.events={},this.events.dataStoreStateChanged=[],b.event&&(this.events[b.event]=[])}return e(a,[{key:"dispatch",value:function(a,b){a?this.observer.dispatch(a,b):(this.observer.dispatch("dataStoreStateChanged",b),this.observer.dispatch(a,b))}},{key:"watch",value:function(a,b){"string"==typeof a?this.events[a]=[this.observer.watch(a,b)]:this.events.dataStoreStateChanged.push(this.observer.watch("dataStoreStateChanged",a))}},{key:"setState",value:function(a){if("function"==typeof a){var c="Array"===f(this.state)?JSON.parse(JSON.stringify(this.state)):"object"===b(this.state)?g(i,this.state):this.state;var d=a.call(this,c);d&&(this.state=d)}else if("Object"===f(this.state)&&"Object"===f(a)){var e=g(this.state,a);this.state=e}}},{key:"unwatch",value:function(a){"dataStoreStateChanged"!==a&&delete this.events[a]}},{key:"state",get:function(){return this[j]},set:function(a){var b=this;this[j]=a;var c=this;this.events&&Object.keys(c.events).map(function(a){a.length&&c.dispatch(a,b.state)})}}]),a}();a.DataStore=k,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=datastore.js.map
