(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.datastore={})})(this,function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(a){return"number"==typeof a&&isNaN(a)?"NaN":/\[object (.*)]/.exec(toString.call(a))[1]}function f(...a){const b=a.map(a=>JSON.parse(JSON.stringify(a)));return b.reduce((c,a)=>Object.assign({},c,a))}class g{constructor(){this.events={}}watch(a,b){return this.events[a]=[],this.events[a].push(b)}dispatch(a,b){return this.events.hasOwnProperty(a)?this.events[a].map(a=>a(b)):[]}unwatch(a){this.events[a]}}var h={},i=function(){let a=new Date().getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(a+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){let c=0|(a+16*Math.random())%16;return a=Math.floor(a/16),("x"===b?c:8|3&c).toString(16)})}(),j=function(){function a(c){b(this,a),this[i]=void 0,this.observer=new g,this.state=c.state,this.events={},this.events.dataStoreStateChanged=[],c.event&&(this.events[c.event]=[])}return d(a,[{key:"dispatch",value:function(a,b){a?this.observer.dispatch(a,b):(this.observer.dispatch("dataStoreStateChanged",b),this.observer.dispatch(a,b))}},{key:"watch",value:function(a,b){"string"==typeof a?this.events[a]=[this.observer.watch(a,b)]:this.events.dataStoreStateChanged.push(this.observer.watch("dataStoreStateChanged",a))}},{key:"setState",value:function(a){if("function"==typeof a){var b=f(h,this.state);var c=a.call(this,b);c&&(this.state=c)}else if("Object"===e(this.state)&&"Object"===e(a)){var d=f(this.state,a);this.state=d}}},{key:"unwatch",value:function(a){"dataStoreStateChanged"!==a&&delete this.events[a]}},{key:"state",get:function(){return this[i]},set:function(a){var b=this;this[i]=a;var c=this;this.events&&Object.keys(c.events).map(function(a){a.length&&c.dispatch(a,b.state)})}}]),a}();a.DataStore=j,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=datastore.js.map
